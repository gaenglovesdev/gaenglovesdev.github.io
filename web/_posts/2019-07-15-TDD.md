---
layout: post
title: "TDD(Test Driven Development)"
description: >
  TDD를 알아보자
category: Web
---

# TDD(Test Driven Development)

---

## 🧐 TDD란?

*TDD*란 Test Driven Development의 줄임말로 반복 테스트를 이용한 소프트웨어 개발 방법론이다.
작은 단위의 테스트 케이스를 작성하고, 이를 통과하는 코드를 추가하는 단계를 반복하여 소프트웨어를 구성한다.

TDD의 목표는 작동하는 깔끔한 코드 "Clean code that works"이다.
이를 위해 두 가지 원칙을 제시한다.

- 오직 자동화된 테스트가 실패할 경우에만 새로운 코드를 작성한다.
- 중복을 제거한다.

## 🤔 Why TDD?

### 기존방식의 잠재적 위험

```
요구사항 분석 -> 설계 -> 개발 -> 테스트 -> 배포 
```
위 개발법에는 소프트웨어 개발을 느리게 하는 잠재적 위험이 존재한다

- 소비자의 요구사항이 처음부터 명확하지 않을 수 있다.
- 따라서 처음부터 완벽한 설계는 어렵다.
- 설계 -> 개발을 진행하면 실제 코드와 설계간 갈등이 생길 수 있다.
- 한 곳의 수정이 다른 곳에 미치는 영향을 확인 및 다른 기능의 정상 도작을 보장하기 어렵다.

### 불확실성이 높을 때 피드백과 협력이 중요하다.

- 불확실성이 높을 때 **피드백**과 **협력**을 이용하면 더 좋은 결과가 나올 확률이 높아진다.
- TDD도 마찬가지로 피드백과 협력을 증진시키는 것이기 때문에 불확실성이 높을 때 도움이 되는 것이다.


## 😮 When TDD?

개발시 어떤 부분에 대한 코딩을 여러번 해봤고, 결과가 어떻게 나올지 뻔하다면 TDD를 하지 않아도 된다.
또한 TDD를 했을 때 얻는 것이 적다면 TDD를 하지 않아도 된다.

#### TDD가 필요한 상황

- 처음해보는 프로그램 주제 (개발자 자신에대한 불확실성이 높은 경우)
- 고객의 요구조건이 바뀔 수 있는 프로젝트(외부적인 불확실성이 높은 경우)
- 개발하는 도중 코드수정이 빈번하다고 예상되는 경우
- 개발 후, 유지보수를 누가 할지 모르는 경우

즉 불확실성이 높을 때 TDD를 권장한다.

## 😎 장단점

### 장점

- 개발자의 방향을 잃지 않게 유지 : 현재 자신의 개발 내용 및 진척 상황을 항상 살펴볼 수 있다.
- 품질 높은 소프트웨어 모듈 보유 : 간결한 코드 유지 가능
- 자동화된 단위 테스트 케이스 소유 : 개발자가 필요한 시점에 언제든 수행할 수 있으며 시스템의 이상 유무를 바로 확인할 수 있다.
- 사용설명서 & 의사 소통의 수단 : 작성된 테스트 케이스는 제품 코드 사용 설명서이자 동시에 다른 개발자와  소통하는 커뮤니케이션 통로가 된다.
- 결함이 줄어든다.
- 


### 단점

- 개발시간이 늘어난다.
- 한계
    - 동시성(Concurrency)
    - 보안 등의 비기능적 요소


## 💡 막연한 생각을 테스트로 전환하는 방법

![TDD PROCESS](/assets/images/tdd/tdd1.png)

TDD는 아래 단계의 반복으로 진행된다.

1. RED : 실패하는 작은 테스트 케이스를 작성한다. 컴파일 조차 안될 수 있다.
2. GREEN : 테스트를 통과하는 코드를 작성한다.
3. REFACTOR : 테스트를 통과하기 위해 만든 코드의 모든 중복을 제거하고, 불명확한 것을 명확히 한다.

**"비밀번호 강도 측정하기"** 예제로 시작해보자.

### 1단계 : 입력과 출력 결정하기

우리는 이 과정을 하이레벨로부터 시작할 것이다. 당장에는 구현을 고려하지 않는다.

우리의 목표: 비밀번호 강도의 측정. 이를 위해서 보통은 입력값들이 필요하고… 다음으로, 그에 근거한 출력값을 얻을 것이다.

일반적으로 어떤 목표를 위해 코드를 작성하기 시작한다면, 아마 당신은 함수로 운을 뗄 것이다.

대개는 함수의 동작에 어떤 데이터가 필요한지, 그리고 어떤 종류의 결과값을 반환할 지 등을 생각한다.

우리는 똑같이 절차를 시작할 것이다 — 다만 아직은 어떤 코드도 작성하지 않을 것이다.

그래서 어떻게 하면 될까?

- 입력값은 쉽다. 비밀번호.
- 결과값도 쉽다. : 비밀번호의 강도를 나타내는 어떤 값이 되어야 한다. 간단하게 하려면, 비밀번호가 강력하거나 아니거나 — 즉 boolean값을 출력에 사용할 수 있다.

### 2단계: 함수 시그니처 선택하기

이제 어떤 데이터가 들어오고 나가는지 알았으니, 우리는 함수 시그니처를 골라야 한다 — 즉 함수가 어떤 매개변수들을 취하며, 어떤 결과를 반환하는 지를 말한다.

이번 과정도 TDD와 무관하게 당신이 코드 작성에 접근하는 방법과 비슷하다. 어떤 함수 코드든 작성하기 전에, 당신은 매개변수와 반환 값이 무엇이 될 지 정해야 한다.

먼저, 매개변수. 우리의 함수는 어떤 동작을 해야할까? 이 경우에는 간단한데 — 필요한 것은 비밀번호 뿐이다. 우리는 단 하나의 값에만 의존해 모든 측정을 할 수 있다.

반환값은 어떨까? 측정이기 때문에 간단한데, 결과를 곧장 반환할 수 있다. 보다 복잡한 상황이라면, 반환값은 Promise가 된다. 또는 값을 반환하는 대신, 콜백 매개변수를 취하거나 — 아무것도 반환하지 않을 수도 있다.

어쨌든간에, 이 시점에서 함수 호출을 어떻게 할지 결정할 수 있다

```js
var strong = isStrongPassword(‘password string goes here’);
```

### 3단계: 기능상 아주 작은 하나의 관점으로 판단하기

이제 우리는 목표, 관련 데이터와 함수 시그니처를 알고있다.

TDD가 아닌 방식이라면, 당신은 코드 작성에 돌입할 것이다.

이미 당신에겐 작동 방식에 대한 몇가지 아이디어가 있을 것이다 — 이걸 확인해야 하고, 저걸 확인해야하고, 반환값은 X에 의해 영향받고…


TDD에 있어서 대부분의 사람들이 곤란에 빠지는 지점이 여기다.

당신의 머릿속은 함수를 어떻게 작성할 것인가에 대한 생각들로 가득찼지만 작성을 시작할 때까지 당신은 코드를 정확히 어떻게 설계할 지 확신할 수 없다.

모든 선택지에 대해 생각하는 대신에… 그냥 작은 것에만 집중해보자. 목표에 아주 조금 다가가기 위해 필요한, 최대한 간단한 동작은 뭘까?


흔한 문제점은 너무 큰 덩어리에 매달리거나 해결하려고 하는 것이다. 비밀번호 강도를 생각해보면, 특수문자, 숫자, 길이, 등등… 다양한 규칙들이 있을 것이다. 이 모든 것을 포함하는 테스트를 생각하는 건 당연히 어렵다!


그렇다면 비밀번호 강도 측정이라는 궁극적인 목표에 도달하는 함수를 만들기 위해 시도할 수 있는 가장 단순한 절차는 무엇일까?
만약 TDD와 무관하게 함수를 작성한다면, 맨 첫 줄(아니면 두번째)은 무엇이 될까?
몇 줄을 추가하면 제대로 동작하는 함수에 가까워질 수 있을까?
비밀번호 강도에 관해 가장 단순한 규칙은 빈 문자열이다. 이건 매우 쉽다 — 비밀번호가 비어있다면 출력값은 언제나 `false`여야 한다.


### 4단계: 테스트 구현

우여곡절 끝에, 테스트 코드 구현까지 왔다. 생각보다 쉽다 느끼길 바란다 :)

앞선 과정들이 TDD와 무관하게 코딩하는 것과 실제로 비슷한 걸 알겠는가?

주된 차이점은 함수 구현 대신, 어떻게 호출되어야 하며, 어떤 결과가 발생하는 지에 집중하고 있다는 점이다. 즉 — 어떤 조건 하에서 함수가 어떻게 동작하는 지 생각하고 있다.

함수가 어떻게 동작하는지 테스트하고 싶은 것이다. 어떤 조건 하에서 일단 시작하고나면(특정 매개변수, 시간대, 무엇이든) 테스팅이 무척 쉬워지는데, 외부에서 동작을 바라볼 수 있기 때문이다. 그저 동작을 선택하기만 하면 구현에 대해서 알 필요가 없다.

우리는 비밀번호를 함수의 유일한 매개변수로 결정했다. 비밀번호가 강력하거나 그렇지 않음을 표시하기 위해서 boolean을 반환하기로 결정하기도 했다.

또한 빈 문자열에 대해, 결과값은 항상 false라고 정했다 — 빈 문자열 비밀번호가 약함을 표시하기 위해서.

이제 모든 것을 테스트 코드에 연결해보자

```js
describe('isPasswordStrong', function() {
  it('should give negative result for empty string', function() {
    var password = '';
    var result = isPasswordStrong(password);
    expect(result).to.be.false;
  });
});
```

함수의 한줄 한줄을 모른 채로 쉽게 작성했다는 점에 주목하자.

우리는 빈 문자열이 매개변수로 전달되면, 결과값은 false라고 결정했다.

테스트로 옮길 수 있는 하나의 단순한 동작이다.

### 5단계: 코드 구현

설명이 필요없다. 단지 테스트를 통과할 수 있는 최소한의 코드만 추가한다.

```js
function isPasswordStrong(password) {
  if(!password) {
    return false;
  }
}

```

계속해서 비밀번호 강도 측정 함수를 개발하고 싶다면, 그냥 반복하면 된다.

우리는 3단계로 돌아가서, 아주 작은 다음 단계를 선택할 것이다. 4단계, 테스트 로직 추가. 5단계, 구현. 반복.

이런 작은 절차들을 거듭해서 전진하다보면, 갑자기 TDD가 훨씬 쉬워질 것이다.

그렇다 — 결국엔 아주 짧은 코드에 대한 몇번의 테스트로 끝날 수도 있지만, 그것도 나쁘지 않다.

TDD는 당신이 작성할 법한 쓸데없는 코드의 양을 줄여줌으로써 도움이 된다,
왜냐하면 당신이 추가하는 모든 코드가 테스트에 의해 검증되기 때문이다.

*Thanks to*

[참고 : Park's Park - Test-Driven Development](https://soulpark.wordpress.com/2012/09/12/test-driven-development/)

[참고 : heejeong Kwon - [Agile] TDD(테스트 주도 개발)란](https://gmlwjd9405.github.io/2018/06/03/agile-tdd.html)

[참고 : cmygray - [번역]쉬운 테스트 주도 개발과 단위 테스트를 위한 5단계 방법론](https://medium.com/@cmygray/%EB%B2%88%EC%97%AD-%EC%89%AC%EC%9A%B4-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C%EA%B3%BC-%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8%EB%A5%BC-%EC%9C%84%ED%95%9C-5%EB%8B%A8%EA%B3%84-%EB%B0%A9%EB%B2%95%EB%A1%A0-b82fea6c8d90)